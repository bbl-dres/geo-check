<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BBL Liegenschaftsinventar - Korrekturen</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Mapbox GL JS CSS -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css" rel="stylesheet">

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>

  <!-- CSS -->
  <link rel="stylesheet" href="css/tokens.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo">
      <img src="assets/swiss-logo-flag.svg" alt="Schweizerische Eidgenossenschaft" class="logo-flag">
      <div class="logo-text">
        <div class="logo-text-primary">Bundesamt für Bauten und Logistik</div>
        <div class="logo-text-secondary">Korrekturen Liegenschaftsinventar</div>
      </div>
    </div>

    <nav class="nav-tabs">
      <button class="nav-tab active" data-tab="karte">Karte</button>
      <button class="nav-tab" data-tab="aufgaben">Aufgaben</button>
      <button class="nav-tab" data-tab="statistik">Statistik</button>
      <button class="nav-tab" data-tab="settings">Einstellungen & Export</button>
    </nav>

    <div class="header-actions">
      <div class="search-container" id="search-container">
        <button class="search-toggle" id="search-toggle" type="button">
          <i data-lucide="search" class="icon"></i>
        </button>
        <input type="text" class="search-input" placeholder="Ort suchen..." id="globalSearch" autocomplete="off">
        <button class="search-clear" id="search-clear" type="button">
          <i data-lucide="x" class="icon-sm"></i>
        </button>
        <div class="search-dropdown" id="search-dropdown">
          <div class="search-results" id="search-results"></div>
        </div>
      </div>
      <button class="filter-toggle active" id="filter-toggle" type="button">
        <i data-lucide="sliders-horizontal" class="icon"></i>
      </button>
      <div class="user-avatar">MK</div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Global Filter Bar -->
    <div class="filter-bar" id="filter-bar">
      <div class="filter-chips">
        <button class="filter-chip" data-filter="high">
          <span>Hoch</span>
          <span class="count" id="count-high">(3)</span>
        </button>
        <button class="filter-chip" data-filter="medium">
          <span>Mittel</span>
          <span class="count" id="count-medium">(4)</span>
        </button>
        <button class="filter-chip" data-filter="low">
          <span>Niedrig</span>
          <span class="count" id="count-low">(5)</span>
        </button>
      </div>
      <div class="filter-divider"></div>
      <button class="filter-chip" data-filter="my-tasks">Meine Aufgaben</button>
      <div class="filter-divider"></div>

      <!-- Multi-select: Kanton -->
      <div class="multi-select" id="filter-kanton">
        <button class="multi-select-trigger" type="button">
          <span class="multi-select-label">Kanton</span>
          <i data-lucide="chevron-down" class="icon-sm"></i>
        </button>
        <div class="multi-select-dropdown">
          <div class="multi-select-actions">
            <button type="button" class="multi-select-action" data-action="all">Alle</button>
            <button type="button" class="multi-select-action" data-action="none">Keine</button>
          </div>
          <div class="multi-select-options">
            <label class="multi-select-option"><input type="checkbox" value="TG"><span>TG</span></label>
            <label class="multi-select-option"><input type="checkbox" value="SG"><span>SG</span></label>
            <label class="multi-select-option"><input type="checkbox" value="ZH"><span>ZH</span></label>
            <label class="multi-select-option"><input type="checkbox" value="BE"><span>BE</span></label>
            <label class="multi-select-option"><input type="checkbox" value="GR"><span>GR</span></label>
            <label class="multi-select-option"><input type="checkbox" value="LU"><span>LU</span></label>
            <label class="multi-select-option"><input type="checkbox" value="GE"><span>GE</span></label>
            <label class="multi-select-option"><input type="checkbox" value="TI"><span>TI</span></label>
            <label class="multi-select-option"><input type="checkbox" value="BS"><span>BS</span></label>
          </div>
        </div>
      </div>

      <!-- Multi-select: Konfidenz -->
      <div class="multi-select" id="filter-confidence">
        <button class="multi-select-trigger" type="button">
          <span class="multi-select-label">Konfidenz</span>
          <i data-lucide="chevron-down" class="icon-sm"></i>
        </button>
        <div class="multi-select-dropdown">
          <div class="multi-select-actions">
            <button type="button" class="multi-select-action" data-action="all">Alle</button>
            <button type="button" class="multi-select-action" data-action="none">Keine</button>
          </div>
          <div class="multi-select-options">
            <label class="multi-select-option"><input type="checkbox" value="critical"><span>Kritisch</span></label>
            <label class="multi-select-option"><input type="checkbox" value="warning"><span>Warnung</span></label>
            <label class="multi-select-option"><input type="checkbox" value="ok"><span>OK</span></label>
          </div>
        </div>
      </div>

      <!-- Multi-select: Portfolio -->
      <div class="multi-select" id="filter-portfolio">
        <button class="multi-select-trigger" type="button">
          <span class="multi-select-label">Portfolio</span>
          <i data-lucide="chevron-down" class="icon-sm"></i>
        </button>
        <div class="multi-select-dropdown">
          <div class="multi-select-actions">
            <button type="button" class="multi-select-action" data-action="all">Alle</button>
            <button type="button" class="multi-select-action" data-action="none">Keine</button>
          </div>
          <div class="multi-select-options">
            <label class="multi-select-option"><input type="checkbox" value="Büro"><span>Büro</span></label>
            <label class="multi-select-option"><input type="checkbox" value="Wohnen"><span>Wohnen</span></label>
            <label class="multi-select-option"><input type="checkbox" value="Öffentlich"><span>Öffentlich</span></label>
            <label class="multi-select-option"><input type="checkbox" value="Industrie"><span>Industrie</span></label>
            <label class="multi-select-option"><input type="checkbox" value="Bildung"><span>Bildung</span></label>
          </div>
        </div>
      </div>

      <!-- Multi-select: Status -->
      <div class="multi-select" id="filter-status">
        <button class="multi-select-trigger" type="button">
          <span class="multi-select-label">Status</span>
          <i data-lucide="chevron-down" class="icon-sm"></i>
        </button>
        <div class="multi-select-dropdown">
          <div class="multi-select-actions">
            <button type="button" class="multi-select-action" data-action="all">Alle</button>
            <button type="button" class="multi-select-action" data-action="none">Keine</button>
          </div>
          <div class="multi-select-options">
            <label class="multi-select-option"><input type="checkbox" value="backlog"><span>Backlog</span></label>
            <label class="multi-select-option"><input type="checkbox" value="inprogress"><span>In Bearbeitung</span></label>
            <label class="multi-select-option"><input type="checkbox" value="clarification"><span>Abklärung</span></label>
            <label class="multi-select-option"><input type="checkbox" value="done"><span>Erledigt</span></label>
          </div>
        </div>
      </div>

      <!-- Multi-select: Zugewiesen -->
      <div class="multi-select" id="filter-assignee">
        <button class="multi-select-trigger" type="button">
          <span class="multi-select-label">Zugewiesen</span>
          <i data-lucide="chevron-down" class="icon-sm"></i>
        </button>
        <div class="multi-select-dropdown">
          <div class="multi-select-actions">
            <button type="button" class="multi-select-action" data-action="all">Alle</button>
            <button type="button" class="multi-select-action" data-action="none">Keine</button>
          </div>
          <div class="multi-select-options">
            <label class="multi-select-option"><input type="checkbox" value="M. Keller"><span>M. Keller</span></label>
            <label class="multi-select-option"><input type="checkbox" value="S. Brunner"><span>S. Brunner</span></label>
            <label class="multi-select-option"><input type="checkbox" value="T. Weber"><span>T. Weber</span></label>
            <label class="multi-select-option"><input type="checkbox" value="A. Meier"><span>A. Meier</span></label>
            <label class="multi-select-option"><input type="checkbox" value=""><span>Nicht zugewiesen</span></label>
          </div>
        </div>
      </div>

      <div class="filter-divider"></div>
      <button class="filter-reset-btn" id="filter-reset" type="button">
        <i data-lucide="rotate-ccw" class="icon-sm"></i>
        <span>Zurücksetzen</span>
      </button>

      <div class="filter-spacer"></div>
      <div class="filter-total" id="filter-total">
        <span id="filtered-count">12</span> / <span id="total-count">20</span> Gebäude
      </div>
    </div>

    <!-- Karte Tab -->
    <div class="tab-content active" id="tab-karte">
      <div class="karte-layout">
        <!-- Map Container (map + table) -->
        <div class="map-container">
          <!-- Map Panel -->
          <div class="map-panel">
            <div id="map"></div>

            <!-- Layer Visibility Widget -->
            <div class="layer-widget collapsed" id="layer-widget">
              <button class="layer-widget-trigger" id="layer-widget-trigger" title="Kartenebenen">
                <i data-lucide="layers" class="icon"></i>
              </button>
              <div class="layer-widget-panel" id="layer-widget-panel">
                <div class="layer-widget-header" title="Einklappen">
                  <i data-lucide="layers" class="icon"></i>
                  <span>Kartenebenen</span>
                  <i data-lucide="chevron-up" class="icon-sm"></i>
                </div>
                <div class="layer-widget-content">
                  <label class="layer-item">
                    <input type="checkbox" id="layer-oereb" data-layer="ch.swisstopo-vd.stand-oerebkataster">
                    <span class="layer-name">ÖREB Verfügbarkeit</span>
                    <button class="layer-info-btn" data-layer="ch.swisstopo-vd.stand-oerebkataster" title="Layer-Info">
                      <i data-lucide="info" class="icon-sm"></i>
                    </button>
                  </label>
                  <label class="layer-item">
                    <input type="checkbox" id="layer-gwr" data-layer="ch.bfs.gebaeude_wohnungs_register">
                    <span class="layer-name">GWR Gebäudestatus</span>
                    <button class="layer-info-btn" data-layer="ch.bfs.gebaeude_wohnungs_register" title="Layer-Info">
                      <i data-lucide="info" class="icon-sm"></i>
                    </button>
                  </label>
                </div>
                <div class="layer-widget-footer">
                  <span>© Swisstopo</span>
                </div>
              </div>
            </div>

            <div class="basemap-selector" id="basemap-selector">
              <div class="basemap-panel" id="basemap-panel">
                <button class="basemap-option" data-basemap="none">
                  <div class="basemap-thumb basemap-none"><span>Kein HG</span></div>
                </button>
                <button class="basemap-option active" data-basemap="grey">
                  <div class="basemap-thumb basemap-grey"><span>Grau</span></div>
                </button>
                <button class="basemap-option" data-basemap="color">
                  <div class="basemap-thumb basemap-color"><span>Farbig</span></div>
                </button>
                <button class="basemap-option" data-basemap="satellite">
                  <div class="basemap-thumb basemap-satellite"><span>Luftbild</span></div>
                </button>
              </div>
              <button class="basemap-trigger" id="basemap-trigger" title="Hintergrund wechseln">
                <div class="basemap-thumb basemap-grey" id="basemap-trigger-thumb">
                  <span id="basemap-trigger-label">Grau</span>
                  <i data-lucide="chevron-right" class="icon-sm trigger-chevron"></i>
                </div>
              </button>
            </div>

            <!-- Scale Bar -->
            <div class="scale-bar" id="scale-bar">
              <div class="scale-bar-line" id="scale-bar-line"></div>
              <span class="scale-bar-text" id="scale-bar-text">100 m</span>
            </div>

            <button class="table-toggle-btn active" id="table-toggle-btn">
              <i data-lucide="chevron-up" class="icon-sm chevron"></i>
              <span>Tabelle</span>
            </button>
          </div>

          <!-- Table View Panel (hidden by default) -->
          <div class="table-panel visible" id="table-panel">
            <div class="table-resize-handle" id="table-resize-handle">
              <div class="resize-handle-bar"></div>
            </div>
            <div class="table-panel-header">
              <div class="table-search">
                <i data-lucide="search" class="icon-sm"></i>
                <input type="text" id="table-search-input" placeholder="Suchen..." autocomplete="off">
                <button class="table-search-clear" id="table-search-clear" type="button">
                  <i data-lucide="x" class="icon-sm"></i>
                </button>
              </div>
              <div class="table-columns-container">
                <button class="table-columns-btn" id="table-columns-btn" type="button" title="Spalten ein-/ausblenden">
                  <i data-lucide="columns-3" class="icon-sm"></i>
                  <span>Spalten</span>
                  <i data-lucide="chevron-down" class="icon-sm"></i>
                </button>
                <div class="table-columns-dropdown" id="table-columns-dropdown">
                  <div class="columns-dropdown-label">Spalten anzeigen</div>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="priority" checked>
                    <span>Priorität</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="id" checked disabled>
                    <span>ID</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="name" checked disabled>
                    <span>Name</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="kanton">
                    <span>Kanton</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="portfolio">
                    <span>Portfolio</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="status" checked>
                    <span>Status</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="confidence" checked>
                    <span>Konfidenz</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="errors">
                    <span>Fehlertypen</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="assignee" checked>
                    <span>Zugewiesen</span>
                  </label>
                  <label class="columns-dropdown-item">
                    <input type="checkbox" data-col="updated" checked>
                    <span>Aktualisiert</span>
                  </label>
                </div>
              </div>
              <div class="table-export-container">
                <button class="table-export-btn" id="table-export-btn" type="button">
                  <i data-lucide="download" class="icon-sm"></i>
                  <span>Exportieren</span>
                  <i data-lucide="chevron-down" class="icon-sm"></i>
                </button>
                <div class="table-export-dropdown" id="table-export-dropdown">
                  <div class="export-dropdown-section">
                    <div class="export-dropdown-label">Alle exportieren</div>
                    <button class="export-dropdown-item" data-export="all-csv">Als CSV</button>
                    <button class="export-dropdown-item" data-export="all-xlsx">Als XLSX</button>
                    <button class="export-dropdown-item" data-export="all-geojson">Als GeoJSON</button>
                  </div>
                  <div class="export-dropdown-section export-selection-section" id="export-selection-section" style="display: none;">
                    <div class="export-dropdown-label">Auswahl exportieren</div>
                    <button class="export-dropdown-item" data-export="selection-csv">Als CSV</button>
                    <button class="export-dropdown-item" data-export="selection-xlsx">Als XLSX</button>
                    <button class="export-dropdown-item" data-export="selection-geojson">Als GeoJSON</button>
                  </div>
                </div>
              </div>
              <button class="table-panel-close" id="table-close-btn" type="button">
                <i data-lucide="x" class="icon"></i>
              </button>
            </div>
            <div class="table-panel-content">
              <table class="buildings-table">
                <thead>
                  <tr>
                    <th class="col-checkbox"><input type="checkbox" id="table-select-all-header" title="Alle auf dieser Seite auswählen"></th>
                    <th data-col="priority">Priorität</th>
                    <th data-col="id">ID</th>
                    <th data-col="name">Name</th>
                    <th data-col="kanton" class="col-hidden">Kanton</th>
                    <th data-col="portfolio" class="col-hidden">Portfolio</th>
                    <th data-col="status">Status</th>
                    <th data-col="confidence">Konfidenz</th>
                    <th data-col="errors" class="col-hidden">Fehlertypen</th>
                    <th data-col="assignee">Zugewiesen</th>
                    <th data-col="updated">Aktualisiert</th>
                  </tr>
                </thead>
                <tbody id="table-body">
                  <!-- Populated by JS -->
                </tbody>
              </table>
            </div>
            <div class="table-panel-footer">
              <div class="table-footer-left">
                <span class="table-selection-count" id="table-selection-count"></span>
              </div>
              <div class="table-footer-center">
                <div class="table-pagination" id="table-pagination">
                  <button class="pagination-btn" id="pagination-prev" type="button" disabled>
                    <i data-lucide="chevron-left" class="icon-sm"></i>
                  </button>
                  <div class="pagination-pages" id="pagination-pages"></div>
                  <button class="pagination-btn" id="pagination-next" type="button">
                    <i data-lucide="chevron-right" class="icon-sm"></i>
                  </button>
                </div>
              </div>
              <div class="table-footer-right">
                <span class="table-count" id="table-count">0 Gebäude</span>
                <div class="table-page-size">
                  <select id="table-page-size">
                    <option value="100" selected>100</option>
                    <option value="500">500</option>
                    <option value="1000">1000</option>
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Detail Panel -->
        <div class="detail-panel" id="detail-panel">
          <div class="detail-resize-handle" id="detail-resize-handle">
            <div class="resize-handle-bar-vertical"></div>
          </div>
          <div class="detail-content" id="detail-content">
            <div class="detail-header">
              <button class="detail-close-btn" id="detail-close-btn" title="Schliessen">
                <i data-lucide="x"></i>
              </button>
              <h2 class="detail-title" id="detail-title">Building Name</h2>
              <p class="detail-subtitle" id="detail-sap-id">SAP ID</p>
            </div>

            <div class="detail-section accordion open" data-accordion="konfidenz">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Konfidenz</span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <div class="confidence-container">
                  <div class="confidence-total" id="confidence-total">67%</div>
                  <div class="confidence-bars">
                    <div class="confidence-bar-row">
                      <span class="confidence-bar-label">Georef</span>
                      <div class="confidence-bar-track">
                        <div class="confidence-bar-fill" id="bar-georef" style="width: 67%"></div>
                      </div>
                      <span class="confidence-bar-value" id="val-georef">67%</span>
                    </div>
                    <div class="confidence-bar-row">
                      <span class="confidence-bar-label">SAP</span>
                      <div class="confidence-bar-track">
                        <div class="confidence-bar-fill ok" id="bar-sap" style="width: 100%"></div>
                      </div>
                      <span class="confidence-bar-value" id="val-sap">100%</span>
                    </div>
                    <div class="confidence-bar-row">
                      <span class="confidence-bar-label">GWR</span>
                      <div class="confidence-bar-track">
                        <div class="confidence-bar-fill ok" id="bar-gwr" style="width: 100%"></div>
                      </div>
                      <span class="confidence-bar-value" id="val-gwr">100%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-section accordion" data-accordion="fehler">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Fehler</span>
                <span class="accordion-count" id="error-count"></span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <div id="error-cards">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>

            <div class="detail-section accordion open" data-accordion="status">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Status & Zugewiesen</span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <div class="status-section">
                  <div class="status-row">
                    <span class="status-label">Status</span>
                    <div class="status-display" id="status-display">
                      <!-- Populated by JS -->
                    </div>
                  </div>
                  <div class="status-row">
                    <span class="status-label">Zugewiesen</span>
                    <div class="assignee-display" id="assignee-display">
                      <!-- Populated by JS -->
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-section accordion open" data-accordion="datenvergleich">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Datenvergleich</span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <table class="data-table">
                  <thead>
                    <tr>
                      <th class="col-attr">Attribut</th>
                      <th class="col-sap">SAP RE-FX</th>
                      <th class="col-gwr">GWR</th>
                      <th class="col-match"></th>
                    </tr>
                  </thead>
                  <tbody id="data-comparison">
                    <!-- Populated by JS -->
                  </tbody>
                </table>
                <div class="data-actions">
                  <button class="data-correct-btn" id="btn-correct" type="button">Daten bearbeiten</button>
                  <div class="edit-actions" id="edit-actions" style="display: none;">
                    <button class="edit-cancel-btn" id="btn-edit-cancel" type="button">Abbrechen</button>
                    <button class="edit-save-btn" id="btn-edit-save" type="button">Speichern</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-section accordion" data-accordion="kommentare">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Kommentare</span>
                <span class="accordion-count" id="comments-count"></span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <div id="comments-list">
                  <!-- Populated by JS -->
                </div>
                <div class="comment-input-section">
                  <textarea class="comment-input" id="comment-input" placeholder="Kommentar schreiben..." rows="2"></textarea>
                  <div class="comment-actions">
                    <button class="action-btn secondary btn-sm" id="btn-cancel-comment" type="button">Abbrechen</button>
                    <button class="action-btn primary btn-sm" id="btn-submit-comment" type="button">Speichern</button>
                  </div>
                </div>
              </div>
            </div>

            <div class="detail-section accordion" data-accordion="ereignisse">
              <button class="accordion-header" type="button">
                <span class="accordion-title">Ereignisse</span>
                <span class="accordion-count" id="events-count"></span>
                <i data-lucide="chevron-down" class="icon-sm accordion-chevron"></i>
              </button>
              <div class="accordion-content">
                <div class="events-list" id="events-list">
                  <!-- Populated by JS -->
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Aufgaben Tab -->
    <div class="tab-content" id="tab-aufgaben">
      <div class="aufgaben-content">
        <div class="kanban-container">
          <div class="kanban-column">
            <div class="kanban-header">
              <span class="kanban-header-icon"><i data-lucide="layers" class="icon"></i></span>
              <span class="kanban-header-title">Backlog</span>
              <span class="kanban-header-count" id="kanban-backlog-count">234</span>
            </div>
            <div class="kanban-cards" id="kanban-backlog">
              <!-- Populated by JS -->
            </div>
          </div>

          <div class="kanban-column">
            <div class="kanban-header">
              <span class="kanban-header-icon"><i data-lucide="play-circle" class="icon"></i></span>
              <span class="kanban-header-title">In Bearbeitung</span>
              <span class="kanban-header-count" id="kanban-inprogress-count">89</span>
            </div>
            <div class="kanban-cards" id="kanban-inprogress">
              <!-- Populated by JS -->
            </div>
          </div>

          <div class="kanban-column">
            <div class="kanban-header">
              <span class="kanban-header-icon"><i data-lucide="help-circle" class="icon"></i></span>
              <span class="kanban-header-title">Abklärung</span>
              <span class="kanban-header-count" id="kanban-clarification-count">34</span>
            </div>
            <div class="kanban-cards" id="kanban-clarification">
              <!-- Populated by JS -->
            </div>
          </div>

          <div class="kanban-column">
            <div class="kanban-header">
              <span class="kanban-header-icon"><i data-lucide="check-circle" class="icon"></i></span>
              <span class="kanban-header-title">Erledigt</span>
              <span class="kanban-header-count" id="kanban-done-count">1'842</span>
            </div>
            <div class="kanban-cards" id="kanban-done">
              <!-- Populated by JS -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistik Tab -->
    <div class="tab-content" id="tab-statistik">
      <div class="statistik-content">
        <div class="stat-cards stat-cards-6">
          <div class="stat-card">
            <div class="stat-label">Gebäude</div>
            <div class="stat-value" id="stat-total">20</div>
            <div class="stat-sublabel">Total im Filter</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Datenqualität</div>
            <div class="stat-value" id="stat-quality">68%</div>
            <div class="stat-sublabel">Ø Konfidenz</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Fehler</div>
            <div class="stat-value error" id="stat-errors">24</div>
            <div class="stat-sublabel">Alle Abweichungen</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Kritisch</div>
            <div class="stat-value error" id="stat-critical">12</div>
            <div class="stat-sublabel">Konfidenz &lt; 50%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Validiert</div>
            <div class="stat-value success" id="stat-validated">3</div>
            <div class="stat-sublabel">Konfidenz ≥ 90%</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Offen</div>
            <div class="stat-value" id="stat-pending">17</div>
            <div class="stat-sublabel">Nicht erledigt</div>
          </div>
        </div>

        <div class="charts-grid">
          <!-- Confidence Distribution -->
          <div class="chart-card">
            <h3 class="chart-title">Konfidenz-Verteilung</h3>
            <div class="histogram-chart" id="confidence-histogram">
              <div class="histogram-bar-group">
                <div class="histogram-bar critical" style="height: 60%"></div>
                <span class="histogram-label">0-40%</span>
                <span class="histogram-value">4</span>
              </div>
              <div class="histogram-bar-group">
                <div class="histogram-bar warning" style="height: 45%"></div>
                <span class="histogram-label">40-60%</span>
                <span class="histogram-value">3</span>
              </div>
              <div class="histogram-bar-group">
                <div class="histogram-bar moderate" style="height: 80%"></div>
                <span class="histogram-label">60-80%</span>
                <span class="histogram-value">10</span>
              </div>
              <div class="histogram-bar-group">
                <div class="histogram-bar success" style="height: 25%"></div>
                <span class="histogram-label">80-100%</span>
                <span class="histogram-value">3</span>
              </div>
            </div>
          </div>

          <!-- Errors by Severity -->
          <div class="chart-card">
            <h3 class="chart-title">Fehler nach Schweregrad</h3>
            <div class="severity-chart" id="severity-chart">
              <div class="severity-bars">
                <div class="severity-bar-row">
                  <span class="severity-indicator error"></span>
                  <span class="severity-label">Fehler</span>
                  <div class="severity-bar-track">
                    <div class="severity-bar-fill error" style="width: 60%"></div>
                  </div>
                  <span class="severity-value">12</span>
                </div>
                <div class="severity-bar-row">
                  <span class="severity-indicator warning"></span>
                  <span class="severity-label">Warnung</span>
                  <div class="severity-bar-track">
                    <div class="severity-bar-fill warning" style="width: 40%"></div>
                  </div>
                  <span class="severity-value">8</span>
                </div>
                <div class="severity-bar-row">
                  <span class="severity-indicator info"></span>
                  <span class="severity-label">Hinweis</span>
                  <div class="severity-bar-track">
                    <div class="severity-bar-fill info" style="width: 20%"></div>
                  </div>
                  <span class="severity-value">4</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Errors by Source -->
          <div class="chart-card">
            <h3 class="chart-title">Abweichungen nach Quelle</h3>
            <div class="source-chart" id="source-chart">
              <div class="chart-row">
                <span class="chart-row-label">Georef</span>
                <div class="chart-row-bar">
                  <div class="chart-row-fill georef" style="width: 70%"></div>
                </div>
                <span class="chart-row-value">14</span>
              </div>
              <div class="chart-row">
                <span class="chart-row-label">GWR</span>
                <div class="chart-row-bar">
                  <div class="chart-row-fill gwr" style="width: 40%"></div>
                </div>
                <span class="chart-row-value">8</span>
              </div>
              <div class="chart-row">
                <span class="chart-row-label">SAP</span>
                <div class="chart-row-bar">
                  <div class="chart-row-fill sap" style="width: 55%"></div>
                </div>
                <span class="chart-row-value">11</span>
              </div>
              <div class="chart-row">
                <span class="chart-row-label">Adresse</span>
                <div class="chart-row-bar">
                  <div class="chart-row-fill address" style="width: 25%"></div>
                </div>
                <span class="chart-row-value">5</span>
              </div>
            </div>
          </div>

          <!-- Status by Canton -->
          <div class="chart-card">
            <h3 class="chart-title">Status nach Kanton</h3>
            <div class="kanton-chart" id="kanton-chart">
              <div class="kanton-row">
                <span class="kanton-label">ZH</span>
                <div class="kanton-bar-track">
                  <div class="kanton-bar-fill" style="width: 85%"></div>
                </div>
                <span class="kanton-value">85%</span>
              </div>
              <div class="kanton-row">
                <span class="kanton-label">BE</span>
                <div class="kanton-bar-track">
                  <div class="kanton-bar-fill" style="width: 72%"></div>
                </div>
                <span class="kanton-value">72%</span>
              </div>
              <div class="kanton-row">
                <span class="kanton-label">SG</span>
                <div class="kanton-bar-track">
                  <div class="kanton-bar-fill" style="width: 68%"></div>
                </div>
                <span class="kanton-value">68%</span>
              </div>
              <div class="kanton-row">
                <span class="kanton-label">LU</span>
                <div class="kanton-bar-track">
                  <div class="kanton-bar-fill" style="width: 55%"></div>
                </div>
                <span class="kanton-value">55%</span>
              </div>
              <div class="kanton-row">
                <span class="kanton-label">GR</span>
                <div class="kanton-bar-track">
                  <div class="kanton-bar-fill" style="width: 42%"></div>
                </div>
                <span class="kanton-value">42%</span>
              </div>
            </div>
          </div>

          <!-- Tasks per Assignee -->
          <div class="chart-card">
            <h3 class="chart-title">Aufgaben pro Bearbeiter</h3>
            <div class="assignee-chart" id="assignee-chart">
              <!-- Will be populated dynamically -->
            </div>
          </div>

          <!-- Status by Portfolio -->
          <div class="chart-card">
            <h3 class="chart-title">Status nach Portfolio</h3>
            <div class="portfolio-chart" id="portfolio-chart">
              <!-- Will be populated dynamically -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Einstellungen & Export Tab -->
    <div class="tab-content" id="tab-settings">
      <div class="settings-content">
        <!-- User Management Section -->
        <div class="settings-section">
          <div class="section-header-with-action">
            <h2 class="settings-section-title section-title-icon"><i data-lucide="users" class="icon-lg"></i> Benutzerverwaltung</h2>
            <button class="action-btn primary btn-sm" onclick="openModal('modal-invite-user')">
              <i data-lucide="user-plus" class="icon-sm"></i>
              Einladen
            </button>
          </div>
          <table class="users-table">
            <thead>
              <tr>
                <th>Benutzer</th>
                <th>Rolle</th>
                <th>Status</th>
                <th>Aktionen</th>
              </tr>
            </thead>
            <tbody id="users-table-body">
              <!-- Users will be loaded dynamically -->
            </tbody>
          </table>
        </div>

        <!-- Export Section -->
        <div class="settings-section">
          <h2 class="settings-section-title section-title-icon"><i data-lucide="download" class="icon-lg"></i> Export</h2>
          <div class="export-list">
            <button class="export-row">
              <i data-lucide="download" class="icon-sm"></i>
              <span class="export-name">Prüfplan</span>
              <span class="export-date">Geändert: 28.01.2026, 14:32</span>
              <span class="export-format">PDF</span>
            </button>
            <button class="export-row">
              <i data-lucide="download" class="icon-sm"></i>
              <span class="export-name">Fehlerbericht</span>
              <span class="export-date">Geändert: 27.01.2026, 09:15</span>
              <span class="export-format">XLSX</span>
            </button>
            <button class="export-row">
              <i data-lucide="download" class="icon-sm"></i>
              <span class="export-name">Ereignisse</span>
              <span class="export-date">Geändert: 26.01.2026, 16:48</span>
              <span class="export-format">CSV</span>
            </button>
          </div>
        </div>

        <!-- Checking Rules Section -->
        <div class="settings-section">
          <div class="section-header-with-action">
            <h2 class="settings-section-title section-title-icon"><i data-lucide="shield-check" class="icon-lg"></i> Prüfregeln</h2>
            <button class="action-btn primary btn-sm" id="run-all-checks">
              <i data-lucide="play" class="icon-sm"></i>
              Prüfung starten
            </button>
          </div>
          <p class="section-description">Diese Regeln werden automatisch auf alle Gebäude angewendet. <span class="section-meta-inline">Letzte Prüfung: <span id="last-check-time">—</span></span></p>
          <div class="rules-container" id="rules-container">
            <div class="rules-loading">Regeln werden geladen...</div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-version">v0.1.0</div>
    <div class="footer-links">
      <a href="#" class="footer-link-placeholder">API</a>
      <a href="https://github.com/bbl-dres/geo-check" target="_blank" rel="noopener">Quellcode</a>
      <a href="https://www.admin.ch/gov/de/start/rechtliches.html" target="_blank" rel="noopener">Rechtliches</a>
      <a href="mailto:dres@bbl.admin.ch">Kontakt</a>
    </div>
  </footer>

  <!-- Invite User Modal -->
  <div class="modal-overlay" id="modal-invite-user">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Benutzer einladen</h3>
        <button class="modal-close" onclick="closeModal('modal-invite-user')">×</button>
      </div>
      <div class="modal-body">
        <label class="modal-label">E-Mail-Adresse</label>
        <input type="email" class="modal-input" placeholder="name@bbl.admin.ch">

        <label class="modal-label">Rolle</label>
        <select class="modal-select">
          <option value="reader">Leser - Nur Ansicht</option>
          <option value="editor" selected>Bearbeiter - Kann Daten bearbeiten</option>
          <option value="admin">Admin - Voller Zugriff</option>
        </select>

        <label class="modal-label">Nachricht (optional)</label>
        <textarea class="modal-textarea" placeholder="Persönliche Nachricht zur Einladung..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="modal-btn cancel" onclick="closeModal('modal-invite-user')">Abbrechen</button>
        <button class="modal-btn primary">Einladung senden</button>
      </div>
    </div>
  </div>

  <!-- Layer Info Modal -->
  <div id="layer-info-modal" class="layer-info-modal">
    <div class="layer-info-modal-content">
      <div class="layer-info-modal-header">
        <span class="layer-info-modal-title" id="layer-info-modal-title">Layer Information</span>
        <button class="layer-info-modal-close" id="layer-info-modal-close">
          <i data-lucide="x" class="icon-sm"></i>
        </button>
      </div>
      <div class="layer-info-modal-body" id="layer-info-modal-body">
        <div class="layer-info-loading">Laden...</div>
      </div>
    </div>
  </div>

  <!-- Map Context Menu (Right-Click) -->
  <div id="map-context-menu" class="map-context-menu">
    <div class="context-menu-item context-menu-coords" id="context-menu-coords" title="Klicken zum Kopieren">
      <i data-lucide="copy" class="icon-sm"></i>
      <span id="context-menu-coords-text">47.37623, 8.53048</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" id="context-menu-share">
      <i data-lucide="share-2" class="icon-sm"></i>
      <span>Teilen</span>
    </div>
    <div class="context-menu-item" id="context-menu-center">
      <i data-lucide="crosshair" class="icon-sm"></i>
      <span>Hier zentrieren</span>
    </div>
    <div class="context-menu-item" id="context-menu-nearest">
      <i data-lucide="map-pin" class="icon-sm"></i>
      <span>Nächstes Objekt</span>
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" id="context-menu-google-maps">
      <i data-lucide="map" class="icon-sm"></i>
      <span>In Google Maps öffnen</span>
    </div>
    <div class="context-menu-item" id="context-menu-swisstopo">
      <i data-lucide="mountain" class="icon-sm"></i>
      <span>In Swisstopo öffnen</span>
    </div>
    <div class="context-menu-item" id="context-menu-google-earth">
      <i data-lucide="globe" class="icon-sm"></i>
      <span>In Google Earth 3D öffnen</span>
    </div>
  </div>

  <!-- Mapbox GL JS -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js"></script>

  <!-- Application JavaScript (ES Modules) -->
  <script type="module" src="js/main.js"></script>
</body>
</html>
