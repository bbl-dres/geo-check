{
  "version": "1.0",
  "description": "BBL Geo-Check validation rules — source of truth: docs/RULES.md",
  "ruleSets": [
    {
      "id": "identification",
      "name": "Identifikation",
      "description": "Prüfung der Verknüpfung mit GWR und Kataster",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "ID-001",
          "name": "EGID vorhanden",
          "description": "Prüft ob eine gültige EGID vorhanden ist",
          "field": "egid",
          "operator": "exists",
          "severity": "error",
          "message": "Keine EGID vorhanden"
        },
        {
          "id": "ID-002",
          "name": "EGID Format",
          "description": "Prüft ob die EGID dem korrekten Format entspricht (1-9 Ziffern, keine führenden Nullen)",
          "field": "egid",
          "operator": "matches",
          "value": "^[1-9][0-9]{0,8}$",
          "severity": "error",
          "message": "EGID hat ungültiges Format"
        },
        {
          "id": "ID-003",
          "name": "EGID verifiziert",
          "description": "Prüft ob die EGID auf das korrekte Gebäude im GWR zeigt (nicht auf ein anderes Gebäude)",
          "field": "egid",
          "operator": "equals",
          "severity": "error",
          "message": "EGID zeigt auf ein anderes Gebäude im GWR"
        },
        {
          "id": "ID-004",
          "name": "EGRID vorhanden",
          "description": "Prüft ob eine EGRID für die Kataster-/ÖREB-Verknüpfung vorhanden ist",
          "field": "egrid",
          "operator": "exists",
          "severity": "warning",
          "message": "Keine EGRID vorhanden"
        },
        {
          "id": "ID-005",
          "name": "EGID Duplikat",
          "description": "Prüft ob dieselbe EGID für mehrere SAP-Datensätze verwendet wird",
          "field": "egid",
          "operator": "unique",
          "severity": "error",
          "message": "Dieselbe EGID wird für mehrere Gebäude verwendet"
        },
        {
          "id": "ID-006",
          "name": "Koordinaten Duplikat",
          "description": "Prüft ob dieselben Koordinaten für mehrere SAP-Datensätze verwendet werden",
          "field": ["lat", "lng"],
          "operator": "unique",
          "severity": "warning",
          "message": "Dieselben Koordinaten werden für mehrere Gebäude verwendet"
        },
        {
          "id": "ID-007",
          "name": "Mehrere GWR-Gebäude",
          "description": "Ein SAP-Datensatz ist mit mehreren GWR-Gebäuden verknüpft (1:N)",
          "field": "inGwr",
          "operator": "check",
          "severity": "info",
          "message": "Mehrere GWR-Gebäude mit einem SAP-Objekt verknüpft"
        }
      ]
    },
    {
      "id": "address",
      "name": "Adresse",
      "description": "SAP ↔ GWR Adress-Konsistenz gemäss GeoNV",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "ADR-001",
          "name": "Land",
          "description": "Prüft ob der Ländercode übereinstimmt (soll CH sein)",
          "field": "country",
          "operator": "source_match",
          "severity": "error",
          "message": "Ländercode weicht ab"
        },
        {
          "id": "ADR-002",
          "name": "Kanton",
          "description": "Prüft ob der Kantonscode übereinstimmt",
          "field": "kanton",
          "operator": "source_match",
          "severity": "warning",
          "message": "Kantonscode weicht ab"
        },
        {
          "id": "ADR-003",
          "name": "Gemeinde",
          "description": "Prüft ob der Gemeindename übereinstimmt",
          "field": "gemeinde",
          "operator": "source_match",
          "severity": "warning",
          "message": "Gemeindename weicht ab"
        },
        {
          "id": "ADR-004",
          "name": "PLZ",
          "description": "Prüft ob die Postleitzahl übereinstimmt",
          "field": "plz",
          "operator": "source_match",
          "severity": "warning",
          "message": "Postleitzahl weicht ab"
        },
        {
          "id": "ADR-005",
          "name": "Ort",
          "description": "Prüft ob die Ortsbezeichnung übereinstimmt",
          "field": "ort",
          "operator": "source_match",
          "severity": "warning",
          "message": "Ortsbezeichnung weicht ab"
        },
        {
          "id": "ADR-006",
          "name": "Strasse",
          "description": "Prüft ob der Strassenname übereinstimmt",
          "field": "strasse",
          "operator": "source_match",
          "severity": "info",
          "message": "Strassenname weicht ab"
        },
        {
          "id": "ADR-007",
          "name": "Hausnummer",
          "description": "Prüft ob die Hausnummer übereinstimmt oder fehlt",
          "field": "hausnummer",
          "operator": "source_match",
          "severity": "warning",
          "message": "Hausnummer weicht ab oder fehlt"
        },
        {
          "id": "ADR-008",
          "name": "Zusatz",
          "description": "Prüft ob der Adresszusatz übereinstimmt",
          "field": "zusatz",
          "operator": "source_match",
          "severity": "info",
          "message": "Adresszusatz weicht ab"
        }
      ]
    },
    {
      "id": "geometry",
      "name": "Geometrie",
      "description": "Räumliche Genauigkeit und Koordinaten-Qualität",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "GEO-001",
          "name": "Koordinaten vorhanden",
          "description": "Prüft ob Koordinaten in mindestens einer Quelle vorhanden sind",
          "field": ["lat", "lng"],
          "operator": "exists",
          "severity": "error",
          "message": "Koordinaten fehlen in allen Quellen"
        },
        {
          "id": "GEO-002",
          "name": "Koordinaten-Abweichung",
          "description": "Prüft ob SAP- und GWR-Koordinaten um mehr als 50m abweichen",
          "field": ["lat", "lng"],
          "operator": "distance",
          "value": 50,
          "unit": "meters",
          "severity": "warning",
          "message": "SAP- und GWR-Koordinaten weichen um {value}m ab"
        },
        {
          "id": "GEO-003",
          "name": "Adresse-Koordinaten-Match",
          "description": "Prüft ob die geocodierte Adresse mehr als 100m von den gespeicherten Koordinaten abweicht",
          "field": ["lat", "lng"],
          "operator": "geocode_distance",
          "value": 100,
          "unit": "meters",
          "severity": "info",
          "message": "Adresse und Koordinaten weichen um {value}m ab"
        }
      ]
    }
  ],
  "operators": {
    "exists": "Prüft ob der Wert vorhanden und nicht leer ist",
    "equals": "Prüft auf exakte Übereinstimmung",
    "matches": "Prüft gegen einen regulären Ausdruck",
    "source_match": "Vergleicht SAP- und GWR-Werte (as-is, keine Normalisierung)",
    "unique": "Prüft ob der Wert einmalig ist (kein Duplikat)",
    "distance": "Prüft die Entfernung zwischen zwei Koordinatenpaaren",
    "geocode_distance": "Prüft die Entfernung zwischen geocodierter Adresse und Koordinaten",
    "check": "Allgemeine Prüfung mit benutzerdefinierter Logik"
  },
  "severityLevels": {
    "error": {
      "priority": 1,
      "label": "Fehler",
      "description": "Kritischer Fehler, muss korrigiert werden"
    },
    "warning": {
      "priority": 2,
      "label": "Warnung",
      "description": "Potenzielles Problem, sollte überprüft werden"
    },
    "info": {
      "priority": 3,
      "label": "Hinweis",
      "description": "Information zur Kenntnisnahme"
    }
  }
}
