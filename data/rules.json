{
  "version": "1.0",
  "description": "BBL Geo-Check validation rules — source of truth: docs/RULES.md",
  "ruleSets": [
    {
      "id": "identification",
      "name": "Identifikation",
      "description": "Prüfung der Verknüpfung mit GWR und Kataster",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "ID-001",
          "name": "EGID vorhanden",
          "description": "Prüft ob eine gültige EGID vorhanden ist",
          "attribute": "egid",
          "operator": "exists",
          "severity": "error",
          "message": "Keine EGID vorhanden"
        },
        {
          "id": "ID-003",
          "name": "EGID verifiziert",
          "description": "Prüft ob die EGID auf das korrekte Gebäude im GWR zeigt (nicht auf ein anderes Gebäude)",
          "attribute": "egid",
          "operator": "equals",
          "severity": "error",
          "message": "EGID zeigt auf ein anderes Gebäude im GWR"
        },
        {
          "id": "ID-004",
          "name": "EGRID vorhanden",
          "description": "Prüft ob eine EGRID für die Kataster-/ÖREB-Verknüpfung vorhanden ist",
          "attribute": "egrid",
          "operator": "exists",
          "severity": "warning",
          "message": "Keine EGRID vorhanden"
        },
        {
          "id": "ID-005",
          "name": "EGID Duplikat",
          "description": "Prüft ob dieselbe EGID für mehrere SAP-Datensätze verwendet wird",
          "attribute": "egid",
          "operator": "unique",
          "severity": "error",
          "message": "Dieselbe EGID wird für mehrere Gebäude verwendet"
        },
        {
          "id": "ID-006",
          "name": "Koordinaten Duplikat",
          "description": "Prüft ob dieselben Koordinaten für mehrere SAP-Datensätze verwendet werden",
          "attribute": ["lat", "lng"],
          "operator": "unique",
          "severity": "warning",
          "message": "Dieselben Koordinaten werden für mehrere Gebäude verwendet"
        },
        {
          "id": "ID-007",
          "name": "Mehrfache Gebäudenummern",
          "description": "Prüft ob der Gebäudename oder die Hausnummer mehrere Nummern enthält (z.B. 12, 14, 16 oder 3-5)",
          "attribute": ["name", "hausnummer"],
          "operator": "check",
          "severity": "info",
          "message": "Gebäudename oder Hausnummer enthält mehrere Nummern — möglicherweise mehrere Gebäude in einem SAP-Datensatz"
        }
      ]
    },
    {
      "id": "address",
      "name": "Adresse",
      "description": "SAP ↔ GWR Adress-Konsistenz gemäss GeoNV",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "ADR-001",
          "name": "Land",
          "description": "Prüft ob der Ländercode übereinstimmt (soll CH sein)",
          "attribute": "country",
          "operator": "source_match",
          "severity": "error",
          "message": "Ländercode weicht ab"
        },
        {
          "id": "ADR-002",
          "name": "Kanton",
          "description": "Prüft ob der Kantonscode übereinstimmt",
          "attribute": "kanton",
          "operator": "source_match",
          "severity": "warning",
          "message": "Kantonscode weicht ab"
        },
        {
          "id": "ADR-003",
          "name": "Gemeinde",
          "description": "Prüft ob der Gemeindename übereinstimmt",
          "attribute": "gemeinde",
          "operator": "source_match",
          "severity": "warning",
          "message": "Gemeindename weicht ab"
        },
        {
          "id": "ADR-004",
          "name": "PLZ",
          "description": "Prüft ob die Postleitzahl übereinstimmt",
          "attribute": "plz",
          "operator": "source_match",
          "severity": "warning",
          "message": "Postleitzahl weicht ab"
        },
        {
          "id": "ADR-005",
          "name": "Ort",
          "description": "Prüft ob die Ortsbezeichnung übereinstimmt",
          "attribute": "ort",
          "operator": "source_match",
          "severity": "warning",
          "message": "Ortsbezeichnung weicht ab"
        },
        {
          "id": "ADR-006",
          "name": "Strasse",
          "description": "Prüft ob der Strassenname übereinstimmt",
          "attribute": "strasse",
          "operator": "source_match",
          "severity": "info",
          "message": "Strassenname weicht ab"
        },
        {
          "id": "ADR-007",
          "name": "Hausnummer",
          "description": "Prüft ob die Hausnummer übereinstimmt oder fehlt",
          "attribute": "hausnummer",
          "operator": "source_match",
          "severity": "warning",
          "message": "Hausnummer weicht ab oder fehlt"
        },
        {
          "id": "ADR-008",
          "name": "Zusatz",
          "description": "Prüft ob der Adresszusatz übereinstimmt",
          "attribute": "zusatz",
          "operator": "source_match",
          "severity": "info",
          "message": "Adresszusatz weicht ab"
        }
      ]
    },
    {
      "id": "geometry",
      "name": "Geometrie",
      "description": "Räumliche Genauigkeit und Koordinaten-Qualität",
      "enabled": true,
      "entityType": "building",
      "rules": [
        {
          "id": "GEO-001",
          "name": "Koordinaten vorhanden",
          "description": "Prüft ob Koordinaten in mindestens einer Quelle vorhanden sind",
          "attribute": ["lat", "lng"],
          "operator": "exists",
          "severity": "error",
          "message": "Koordinaten fehlen in allen Quellen"
        },
        {
          "id": "GEO-002",
          "name": "Koordinaten-Abweichung",
          "description": "Prüft ob SAP- und GWR-Koordinaten um mehr als 50m abweichen",
          "attribute": ["lat", "lng"],
          "operator": "distance",
          "value": 50,
          "unit": "meters",
          "severity": "warning",
          "message": "SAP- und GWR-Koordinaten weichen um {value}m ab"
        }
      ]
    }
  ],
  "operators": {
    "exists": "Prüft ob der Wert vorhanden und nicht leer ist",
    "equals": "Prüft auf exakte Übereinstimmung",
    "source_match": "Vergleicht SAP- und GWR-Werte (as-is, keine Normalisierung)",
    "unique": "Prüft ob der Wert einmalig ist (kein Duplikat)",
    "distance": "Prüft die Entfernung zwischen zwei Koordinatenpaaren",
    "check": "Allgemeine Prüfung mit benutzerdefinierter Logik"
  },
  "severityLevels": {
    "error": {
      "priority": 1,
      "label": "Fehler",
      "description": "Kritischer Fehler, muss korrigiert werden"
    },
    "warning": {
      "priority": 2,
      "label": "Warnung",
      "description": "Potenzielles Problem, sollte überprüft werden"
    },
    "info": {
      "priority": 3,
      "label": "Hinweis",
      "description": "Information zur Kenntnisnahme"
    }
  }
}
